<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo & Video Gallery</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="main-wrapper">
        <!-- Left Sidebar Tray -->
        <div class="sidebar-tray">
            <div class="sidebar-header">
                <h2>List my</h2>
            </div>
            <div class="sidebar-list" id="sidebar-list">
                <div class="empty-list">Loading...</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content-wrapper">
            <div class="container">
                <div class="header">
                    <h1>Foto My</h1>
                </div>

                <div class="gallery-wrapper">
                    <div id="items-container">
                        <div id="empty-state" class="empty-state">
                            <p>Loading gallery...</p>
                        </div>
                    </div>

                    <!-- Preview Panel -->
                    <div class="preview-panel" id="preview-panel">
                        <div class="preview-content">
                            <div class="preview-placeholder">
                                <p>Preview of My</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Zoom Modal -->
    <div id="zoom-modal" class="zoom-modal">
        <div class="zoom-container">
            <img id="zoom-image" class="zoom-image" src="" alt="">
            <video id="zoom-video" class="zoom-image" controls style="display: none;"></video>
            <button class="zoom-close" onclick="closeZoom()">&times;</button>
        </div>
    </div>

    <script>
        let items = [];
        const IMAGE_FOLDER = 'laimage/';
        const SUPPORTED_FORMATS = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'mp4', 'webm'];

        // Load items on page load
        loadItems();

        async function loadItems() {
            try {
                // Try to load from manifest.json first
                const response = await fetch('laimage/manifest.json');
                if (response.ok) {
                    items = await response.json();
                } else {
                    items = [];
                }
                displayItems();
            } catch (error) {
                console.error('Error loading manifest:', error);
                items = [];
                displayItems();
            }
        }

        function displayItems() {
            const container = document.getElementById('items-container');
            const sidebarList = document.getElementById('sidebar-list');
            
            if (items.length === 0) {
                container.innerHTML = '<div id="empty-state" class="empty-state"><p>No images in gallery. Add images to the laimage folder and update manifest.json</p></div>';
                sidebarList.innerHTML = '<div class="empty-list">No items</div>';
                return;
            }

            // Update main gallery
            const itemsHTML = items.map((item, index) => {
                const mediaElement = item.image ? 
                    `<img src="${IMAGE_FOLDER}${item.image}" alt="${item.name}" class="item-image">` :
                    '<div class="no-image">No Media</div>';
                
                return `
                    <div class="item-card" onclick="showPreview(${index})">
                        ${mediaElement}
                        <div class="item-content">
                            <h3>${escapeHtml(item.name)}</h3>
                            ${item.description ? `<p class="note">${escapeHtml(item.description)}</p>` : ''}
                            ${item.date ? `<p class="timestamp">${item.date}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = itemsHTML;

            // Update sidebar list
            const sidebarHTML = items.map((item, index) => `
                <div class="sidebar-item" onclick="showPreview(${index})">
                    <div class="sidebar-item-thumb">
                        ${item.image ? `<img src="${IMAGE_FOLDER}${item.image}" alt="${item.name}">` : '<div class="no-thumb">ðŸ“·</div>'}
                    </div>
                    <div class="sidebar-item-text">
                        <div class="sidebar-item-title">${escapeHtml(item.name)}</div>
                        ${item.date ? `<div class="sidebar-item-date">${item.date}</div>` : ''}
                    </div>
                </div>
            `).join('');

            sidebarList.innerHTML = sidebarHTML;
        }
        
        function showPreview(index) {
            if (index < 0 || index >= items.length) return;
            
            const item = items[index];
            const previewPanel = document.getElementById('preview-panel');
            
            if (!item.image) {
                previewPanel.innerHTML = '<div class="preview-content"><div class="preview-placeholder"><p>No media available</p></div></div>';
                return;
            }

            const isVideo = /\.(mp4|webm|avi|mov|mkv)$/i.test(item.image);
            
            let mediaHTML = '';
            if (isVideo) {
                mediaHTML = `<video class="preview-video-player" controls onclick="openZoom('${item.image}', true)" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px; cursor: zoom-in;"><source src="${IMAGE_FOLDER}${item.image}"></video>`;
            } else {
                mediaHTML = `<img src="${IMAGE_FOLDER}${item.image}" alt="${item.name}" onclick="openZoom('${item.image}', false)" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px; cursor: zoom-in;">`;
            }

            previewPanel.innerHTML = `
                <div class="preview-content">
                    <div class="preview-media">
                        ${mediaHTML}
                    </div>
                    <div class="preview-info">
                        <h2>${escapeHtml(item.name)}</h2>
                        ${item.description ? `<p>${escapeHtml(item.description)}</p>` : ''}
                        ${item.date ? `<p class="preview-date">ðŸ“… ${item.date}</p>` : ''}
                    </div>
                </div>
            `;
        }
        
        function scrollToItem(imageName) {
            const cards = document.querySelectorAll('.item-card');
            for (let card of cards) {
                const img = card.querySelector('img');
                if (img && img.src.includes(imageName)) {
                    card.scrollIntoView({ behavior: 'smooth' });
                    break;
                }
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function openZoom(imagePath, isVideo = false) {
            const modal = document.getElementById('zoom-modal');
            const zoomImg = document.getElementById('zoom-image');
            const zoomVid = document.getElementById('zoom-video');

            if (isVideo) {
                zoomImg.style.display = 'none';
                zoomVid.style.display = 'block';
                zoomVid.src = IMAGE_FOLDER + imagePath;
            } else {
                zoomVid.style.display = 'none';
                zoomImg.style.display = 'block';
                zoomImg.src = IMAGE_FOLDER + imagePath;
            }

            modal.classList.add('active');
        }

        function closeZoom() {
            const modal = document.getElementById('zoom-modal');
            modal.classList.remove('active');
            document.getElementById('zoom-image').src = '';
            document.getElementById('zoom-video').src = '';
        }

        // Close zoom modal on background click
        document.getElementById('zoom-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeZoom();
            }
        });

        // Close zoom modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeZoom();
            }
        });
    </script>
</body>
</html>

